<!doctypehtml><html lang=en><meta charset=UTF-8><meta content="width=device-width,initial-scale=1"name=viewport><meta content=no-referrer name=referrer><link href=data:image/x-icon;, rel=icon><title>github.com/dbghelp</title><link href=https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.11.2/controls.min.css rel=stylesheet><link href=https://dbghelp.github.io/xml-epg.css rel=stylesheet><style>body{margin:0;font-family:Arial,sans-serif;display:flex;height:100vh;background-color:#282c34}#playlist{width:350px;background-color:#282c34;color:#fff;overflow-y:auto;border-right:1px solid #444;padding:20px;box-shadow:2px 0 5px rgb(0 0 0 / .2);display:flex;flex-direction:column}#search-input,#url-input{width:100%;padding:10px;margin-bottom:10px;border:1px solid #444;border-radius:5px;background-color:#3c4043;color:#fff;font-size:1em;box-sizing:border-box}#epg-button{display:none;width:100%;padding:10px;margin-bottom:10px;background-color:#61dafb;color:#000;border:none;border-radius:5px;font-size:1em;cursor:pointer;box-shadow:0 4px 8px rgb(0 0 0 / .3)}#fetch-button{width:100%;padding:10px;margin-bottom:10px;background-color:#61dafb;color:#000;border:none;border-radius:5px;font-size:1em;cursor:pointer;box-shadow:0 4px 8px rgb(0 0 0 / .3)}#fetch-button:hover{background-color:#4fa3c4}#epg-button:hover{background-color:#4fa3c4}#video-container{flex:1;display:flex;flex-direction:column;z-index:2}#video{flex:1;width:100%;height:100%;background-color:#000}#video-list{list-style:none;padding:0;margin:0}#video-list li{padding:10px;margin:5px 0;border-radius:5px;cursor:pointer;transition:background-color .3s ease,transform .2s ease;display:flex;align-items:center}#video-list li:hover{background-color:#61dafb;transform:scale(1.05)}#video-list img{width:50px;height:50px;margin-right:10px;border-radius:5px;object-fit:cover;object-fit:contain}.video-title{font-size:1em}.active{background-color:#4fa3c4}#overlay{display:none;flex-direction:column;align-items:center;overflow-y:auto;z-index:2;flex:1}#epg-container{display:none;z-index:1000;position:fixed;width:100%;height:100%;overflow-y:scroll;overflow-x:scroll;background-color:#282c34}#search-input{display:none}.input-container{position:relative;display:flex;align-items:center;width:100%}#upload-button{width:10%;padding:10px;margin-bottom:10px;margin-left:5px;background-color:#61dafb;color:#000;border:none;border-radius:5px;font-size:1em;cursor:pointer;box-shadow:0 4px 8px rgb(0 0 0 / .3)}#upload-button:hover{background-color:#4fa3c4}</style><div id=playlist><div class=input-container><input id=url-input placeholder="Enter M3U8 Playlist URL"> <input id=file-input style=display:none type=file> <button id=upload-button onclick='document.getElementById("file-input").click()'>↑</button></div><button id=fetch-button>Load Playlist</button> <button id=epg-button onclick=openEPG()>EPG</button> <input id=search-input placeholder=Search...><ul id=video-list></ul></div><div id=video-container><video autoplay controls id=video></video></div><div id=overlay></div><div id=epg-container></div><script src=https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/shaka-player.compiled.js></script><script src=https://dbghelp.github.io/M3U8Interpreter.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/pako/2.0.4/pako.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js></script><script src=https://dbghelp.github.io/xml-epg.js></script><script>var xmlepg=new XMLEPG();var overlay=document.getElementById('overlay');var videoContainer=document.getElementById('video-container');var epgContainer=document.getElementById('epg-container');hideOverlayTimeout=null;overlay.addEventListener('mouseenter',()=>{if(hideOverlayTimeout){clearTimeout(hideOverlayTimeout)}
overlay.style.display='flex';videoContainer.style.display='none'});overlay.addEventListener('mouseleave',()=>{overlay.style.display='none';videoContainer.style.display='flex'});document.addEventListener('DOMContentLoaded',()=>{const videoElement=document.getElementById('video');const videoList=document.getElementById('video-list');const searchInput=document.getElementById('search-input');const urlInput=document.getElementById('url-input');const fetchButton=document.getElementById('fetch-button');const fileInput=document.getElementById('file-input');const uploadButton=document.getElementById('upload-button');let selectedFileContent=null;var player=new shaka.Player(videoElement);var channels;var lastActiveChannel;shaka.polyfill.installAll();document.getElementById('upload-button').remove();document.getElementById('url-input').remove();document.getElementById('fetch-button').remove();const m3u8Link='https://m3u.ch/1Vdlwj.m3u('click',async()=>{const url=urlInput.value;if(selectedFileContent){setPlaylistFromFile(selectedFileContent)}else if(url){setPlaylistFromUrl(url)}});fileInput.addEventListener('change',(event)=>{const file=event.target.files[0];if(file){urlInput.value=file.name;const reader=new FileReader();reader.onload=(e)=>{selectedFileContent=e.target.result};reader.readAsText(file)}});async function setPlaylistFromUrl(url){try{const response=await fetch(url);if(response.ok){const text=await response.text();parseAndSetPlaylist(text)}else{console.error('Failed to fetch M3U8 playlist.')}}catch(error){console.error('Error fetching M3U8 playlist:',error)}}
async function setPlaylistFromFile(content){parseAndSetPlaylist(content)}
async function parseAndSetPlaylist(content){const m3u8Interpreter=new M3U8Interpreter(content);m3u8Interpreter.parse();channels=m3u8Interpreter.getChannels();const urls=m3u8Interpreter.getUrlTvg();xmlepg.setPlaylistChannels(channels);xmlepg.load(urls).then(()=>{xmlepg.displayAllPrograms('epg-container','xmlepg')});if(urls!=null&&urls.length!==0){document.getElementById('epg-button').style.display='block'}
updatePlaylist(channels);document.getElementById('search-input').style.display='block'}
function extractAppendedURL(){const params=new URLSearchParams(window.location.search);return params.get('file')}
window.loadVideo=function(manifestUrl,licenseKey){if(licenseKey!=null&&!Array.isArray(licenseKey)){licenseKey=JSON.parse(decodeURIComponent(licenseKey))}
if(licenseKey){licenseKey.forEach(pair=>{player.configure({drm:{clearKeys:{[pair.keyId]:pair.key}}})})}
player.load(manifestUrl);videoElement.play()}
function updatePlaylist(channels){videoList.innerHTML='';channels.forEach(channel=>{const listItem=document.createElement('li');listItem.innerHTML=`
										<img src="${channel.tvgLogo}" alt="${channel.channelName} logo">${channel.channelName}
										</span>`;const imgElement=listItem.querySelector('img');imgElement.onmouseenter=()=>{xmlepg.displayPrograms('overlay',channel.tvgId);overlay.style.display='flex';videoContainer.style.display='none';if(hideOverlayTimeout){clearTimeout(hideOverlayTimeout)}};imgElement.onmouseleave=()=>{hideOverlayTimeout=setTimeout(()=>{overlay.style.display='none';videoContainer.style.display='flex'},100)};listItem.onclick=()=>{loadVideo(channel.manifestUrl,channel.licenseKey);const parent=listItem.parentElement;const children=parent.getElementsByTagName('li');for(let i=0;i<children.length;i++){children[i].classList.remove('active')}
listItem.classList.add('active');lastActiveChannel=listItem.innerHTML}
videoList.appendChild(listItem)})}
function filterPlaylist(searchTerm){const filteredChannels=channels.filter(channel=>channel.channelName.toLowerCase().includes(searchTerm.toLowerCase()));updatePlaylist(filteredChannels)}
searchInput.addEventListener('input',(event)=>{const searchTerm=event.target.value;filterPlaylist(searchTerm)})});function openEPG(){epgContainer.style.display='block';xmlepg.timelineNeedleRender()}
function showToast(message){const style=document.createElement('style');style.innerHTML=`
			.toast-container{position:absolute;top:20px;right:20px;z-index:9999}.toast{background-color:#333;color:#fff;padding:10px 20px;border-radius:5px;margin-bottom:10px;font-size:16px;box-shadow:0 4px 6px rgb(0 0 0 / .1);opacity:0;animation:fadeIn 0.5s forwards,fadeOut 3s forwards 2s}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes fadeOut{from{opacity:1}to{opacity:0}}
		  `;document.head.appendChild(style);const toast=document.createElement('div');toast.classList.add('toast');toast.textContent=message;const toastContainer=document.querySelector('.toast-container');if(!toastContainer){const newContainer=document.createElement('div');newContainer.classList.add('toast-container');document.body.appendChild(newContainer)}
document.querySelector('.toast-container').appendChild(toast);setTimeout(()=>{toast.remove()},4000)}
function copyToClipboard(text,name){text=decodeURIComponent(text);navigator.clipboard.writeText(text.replace(/x123x/g,"'")).then(()=>{showToast(name+' command successfully copied to clipboard')}).catch(err=>{showToast('Failed to copy '+name+' download command: ',err)})}</script>      z-index: 10;
      pointer-events: none; /* Metin kutularının tıklamayı engellememesi için */
    }

    #channelName { top: 10px; left: 10px; }
    #clock { top: 10px; right: 10px; }

    #channelList {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.95);
      overflow-y: auto;
      display: none;
      z-index: 20;
    }

    .list-item {
      padding: 15px;
      font-size: 20px;
      border-bottom: 1px solid #333;
      cursor: pointer;
      user-select: none;
    }

    .list-item:hover,
    .list-item.active {
      background: #555;
    }
  </style>
</head>
<body>
  <div id="player-container">
    <video id="videoPlayer" class="video-js vjs-default-skin" controls preload="auto"></video>
    <div id="channelName">Yüklənir...</div>
    <div id="clock"></div>
  </div>

  <div id="channelList"></div>

  <script>
    const video = videojs('videoPlayer');
    const playerContainer = document.getElementById('player-container');
    const channelListDiv = document.getElementById('channelList');
    const channelNameDisplay = document.getElementById('channelName');

    let channelData = [];
    let currentIndex = 0; // Oynatılan kanalın indeksi
    let listVisible = false;
    let selectedListIndex = 0; // Kanal listesinde seçili olan öğenin indeksi

    function updateClock() {
      const now = new Date();
      document.getElementById('clock').innerText = now.toLocaleString('az-AZ', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
    }
    setInterval(updateClock, 1000);
    updateClock();

    // M3U8 dosyasını yükle
    // BURAYA KENDİ M3U8 KANAL LİSTESİ URL'NİZİ YAPIŞTIRIN!
    const m3u8Url = 'https://raw.githubusercontent.com/nicatiptv/a/refs/heads/main/playlist.m3u';

    fetch(m3u8Url)
      .then(res => {
        if (!res.ok) {
          throw new Error(`HTTP error! status: ${res.status}`);
        }
        return res.text();
      })
      .then(data => {
        const lines = data.split('\n');
        let channel = {};
        lines.forEach(line => {
          if (line.startsWith('#EXTINF')) {
            let name = 'Bilinmeyen Kanal'; 

            // #EXTINF satırından kanal adını çekmek için en basit yöntem: son virgülden sonraki her şeyi al
            const commaIndex = line.lastIndexOf(',');
            if (commaIndex !== -1) {
              name = line.substring(commaIndex + 1).trim();
              if (!name) { // Eğer virgülden sonra boşsa veya sadece boşluk varsa
                // tvg-name özelliğini ara (eğer varsa)
                const tvgNameMatch = line.match(/tvg-name="([^"]+)"/);
                if (tvgNameMatch && tvgNameMatch[1]) {
                  name = tvgNameMatch[1].trim();
                }
              }
            } else {
                 // Eğer #EXTINF satırında virgül yoksa, tvg-name ara
                 const tvgNameMatch = line.match(/tvg-name="([^"]+)"/);
                 if (tvgNameMatch && tvgNameMatch[1]) {
                   name = tvgNameMatch[1].trim();
                 }
            }
            channel = { name: name };
          } else if (line.startsWith('http')) {
            channel.url = line.trim();
            // Kanal adı hala belirlenmemişse (varsayılan 'Bilinmeyen Kanal' ise) ve bir URL varsa, URL'den bir isim türetmeye çalış
            if (channel.name === 'Bilinmeyen Kanal' || !channel.name) {
                const urlParts = channel.url.split('/');
                let inferredName = urlParts[urlParts.length - 1].split('.')[0]; // Dosya adını al
                inferredName = inferredName.replace(/[-_]/g, ' ').replace(/\b\w/g, char => char.toUpperCase()); // Okunabilir hale getir
                if (inferredName && inferredName.length > 1) { // Boş veya çok kısa isimlerden kaçın
                    channel.name = inferredName;
                } else {
                    channel.name = 'Kanal (URL Kaynaklı)'; // Daha spesifik bir bilinmeyen kanal
                }
            }

            if (channel.name && channel.url) { // Hem ad hem URL varsa kanalı ekle
              channelData.push(channel);
            }
            channel = {}; // Bir sonraki kanal için sıfırla
          }
        });

        showChannels();
        if (channelData.length > 0) {
          playChannel(channelData[0]);
        } else {
          channelNameDisplay.innerText = "Kanal listesi bulunamadı veya boş. M3U8 formatını kontrol edin.";
        }
      })
      .catch(error => {
        console.error("M3U8 dosyası yüklenirken veya işlenirken hata oluştu:", error);
        channelNameDisplay.innerText = `Kanal listesi yüklenemedi: ${error.message}. Konsolu kontrol edin.`;
      });

    // Kanalı oynat
    function playChannel(ch) {
      if (!ch || !ch.url) {
        console.warn("Geçersiz kanal bilgisi veya URL eksik:", ch);
        channelNameDisplay.innerText = "Kanal oynatılamıyor: Geçersiz URL";
        return;
      }
      video.src({ src: ch.url, type: 'application/x-mpegURL' });
      video.play().catch(error => {
        console.error("Video oynatma hatası:", error);
        // HLS kaynakları için video.js'in hls.js eklentisine ihtiyacı olabilir (örneğin videojs-contrib-hls)
        channelNameDisplay.innerText = `${ch.name} oynatılamıyor. Desteklenen bir format mı? (Konsolu kontrol edin)`;
      });
      channelNameDisplay.innerText = ch.name;
      currentIndex = channelData.indexOf(ch);
      highlightActive(currentIndex); // Oynatılan kanalı listede vurgula
    }

    // Kanal listesini oluştur ve göster
    function showChannels() {
      channelListDiv.innerHTML = '';
      channelData.forEach((ch, idx) => {
        const item = document.createElement('div');
        item.className = 'list-item';
        item.innerText = ch.name;
        item.dataset.index = idx; // Kanal indeksini kaydet

        // Fare tıklaması veya dokunma ile kanal oynatma
        item.addEventListener('click', () => {
          playChannel(ch);
          toggleChannelList(false);
        });

        channelListDiv.appendChild(item);
      });
    }

    // Kanal listesinin görünürlüğünü ayarla
    function toggleChannelList(show) {
      listVisible = show;
      channelListDiv.style.display = show ? 'block' : 'none';
      if (show) {
        selectedListIndex = currentIndex; // Listeyi açtığında oynatılan kanalı seçili yap
        highlightActive(selectedListIndex);
      }
    }

    // Listede aktif olan öğeyi vurgula ve görünür alana kaydır
    function highlightActive(index) {
      const items = document.querySelectorAll('.list-item');
      items.forEach(item => item.classList.remove('active')); // Tüm 'active' sınıflarını kaldır

      if (items[index]) {
        items[index].classList.add('active'); // Yeni öğeye 'active' sınıfını ekle
        // Öğeyi görünür alana kaydır, ancak sadece gerekliyse
        const rect = items[index].getBoundingClientRect();
        const parentRect = channelListDiv.getBoundingClientRect();

        // Öğenin tam görünür olup olmadığını kontrol et (hem yukarı hem aşağı)
        if (rect.top < parentRect.top || rect.bottom > parentRect.bottom || rect.top < 0 || rect.bottom > window.innerHeight) {
          items[index].scrollIntoView({ block: "center", behavior: "smooth" });
        }
      }
    }

    // Oynatıcı alanına tıklama/dokunma ile listeyi açıp kapatma
    playerContainer.addEventListener('click', (e) => {
      // Sadece player container'a tıklayınca liste açılsın/kapansın
      // e.target'ın kanal listesi öğesi olup olmadığını kontrol et
      if (!listVisible || (listVisible && !e.target.closest('.list-item'))) {
         toggleChannelList(!listVisible);
      }
    });

    // Klavye tuşları ile kontrol
    document.addEventListener('keydown', e => {
      // DEBUG: Hangi tuşa basıldığını konsola yazdır
      console.log("keydown event:", "key:", e.key, "keyCode:", e.keyCode, "code:", e.code);

      if (listVisible) { // Kanal listesi açıkken
        if (e.key === 'ArrowUp' || e.code === 'ArrowUp') { // e.code da ekledim
          e.preventDefault(); // Varsayılan kaydırma davranışını engelle
          if (selectedListIndex > 0) {
            selectedListIndex--;
            highlightActive(selectedListIndex);
          }
        } else if (e.key === 'ArrowDown' || e.code === 'ArrowDown') { // e.code da ekledim
          e.preventDefault(); // Varsayılan kaydırma davranışını engelle
          if (selectedListIndex < channelData.length - 1) {
            selectedListIndex++;
            highlightActive(selectedListIndex);
          }
        } else if (e.key === 'Enter' || e.key === 'OK' || e.keyCode === 13 || e.code === 'Enter') { // Enter ve OK için daha fazla kontrol
          e.preventDefault();
          console.log("Enter/OK tuşuna basıldı, seçilen index:", selectedListIndex, "Kanal:", channelData[selectedListIndex]?.name); 
          if (channelData[selectedListIndex]) {
            playChannel(channelData[selectedListIndex]);
            toggleChannelList(false); // Kanal seçildikten sonra listeyi gizle
          }
        } else if (e.key === 'Backspace' || e.key === 'Escape' || e.keyCode === 8 || e.code === 'Backspace' || e.code === 'Escape') { // Backspace ve Escape için daha fazla kontrol
          e.preventDefault();
          toggleChannelList(false); // Listeyi kapat
        }
      } else { // Kanal listesi kapalıyken (oynatıcı üzerinde)
        if (e.key === 'ArrowUp' || e.code === 'ArrowUp') {
          e.preventDefault();
          if (currentIndex < channelData.length - 1) {
            currentIndex++;
            playChannel(channelData[currentIndex]);
          }
        } else if (e.key === 'ArrowDown' || e.code === 'ArrowDown') {
          e.preventDefault();
          if (currentIndex > 0) {
            currentIndex--;
            playChannel(channelData[currentIndex]);
          }
        } else if (e.key === 'Enter' || e.key === 'OK' || e.keyCode === 13 || e.code === 'Enter') {
          e.preventDefault();
          toggleChannelList(true); // Listeyi aç
        }
      }
    });

    // Dokunmatik hareketler için değişkenler
    let touchStartX = null;
    let touchStartY = null;

    // Dokunma başlangıcı
    playerContainer.addEventListener('touchstart', e => {
      if (e.touches.length === 1) {
        touchStartX = e.touches[0].clientX;
        touchStartY = e.touches[0].clientY;
      }
    }, { passive: true }); // Dokunma event'ini performansı artırmak için pasif yap

    // Dokunma sonu (Swipes ve kısa dokunuşlar için)
    playerContainer.addEventListener('touchend', e => {
      if (touchStartY !== null && e.changedTouches.length === 1) {
        const endX = e.changedTouches[0].clientX;
        const endY = e.changedTouches[0].clientY;

        const dx = endX - touchStartX;
        const dy = endY - touchStartY;

        touchStartX = null; // Sıfırla
        touchStartY = null; // Sıfırla

        // Kısa dokunuş (tap) kontrolü (hem x hem y yönünde küçük hareket)
        if (Math.abs(dx) < 10 && Math.abs(dy) < 10) {
          // Eğer kanal listesi zaten açık değilse ve bir liste öğesine dokunulmadıysa
          if (!listVisible || (listVisible && !e.target.closest('.list-item'))) {
            toggleChannelList(!listVisible); // Listeyi aç/kapat
          }
        } else if (!listVisible) { // Kanal listesi kapalıyken kaydırma (swipe)
          if (dy < -50) { // Yukarı kaydırma
            if (currentIndex < channelData.length - 1) {
              currentIndex++;
              playChannel(channelData[currentIndex]);
            }
          } else if (dy > 50) { // Aşağı kaydırma
            if (currentIndex > 0) {
              currentIndex--;
              playChannel(channelData[currentIndex]);
            }
          }
        } else { // Kanal listesi açıkken kaydırma (swipe)
          if (dy < -50) { // Yukarı kaydırma (listede yukarı git)
            if (selectedListIndex > 0) {
              selectedListIndex--;
              highlightActive(selectedListIndex);
            }
          } else if (dy > 50) { // Aşağı kaydırma (listede aşağı git)
            if (selectedListIndex < channelData.length - 1) {
              selectedListIndex++;
              highlightActive(selectedListIndex);
            }
          }
        }
      }
    });
  </script>
</body>
</html>
