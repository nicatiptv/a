<!DOCTYPE html>
<html lang="az">
<head>
  <meta charset="UTF-8">
  <title>Mobil N√∂mr…ô il…ô Qeydiyyat v…ô ∆èlaq…ô</title>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; background: #f7f7f7;}
    .container { background: #fff; padding: 24px; border-radius: 10px; max-width: 400px; margin: auto; box-shadow: 0 2px 8px #ccc;}
    h2 { color: #0077aa; }
    input { width: 100%; padding: 8px; margin: 8px 0 12px 0; border: 1px solid #ccc; border-radius: 4px;}
    button { background: #0077aa; color: #fff; padding: 10px 18px; border: none; border-radius: 4px; cursor: pointer;}
    button:hover { background: #005577;}
    .success { color: green;}
    .error { color: red;}
    .section { margin-bottom: 36px;}
  </style>
</head>
<body>
  <div class="container">
    <div class="section">
      <h2>Mobil n√∂mr…ô il…ô qeydiyyat</h2>
      <input id="registerPhone" placeholder="N√∂mr…ônizi daxil edin (m…ôs: +994XXXXXXXXX)">
      <button onclick="sendOtp()">SMS il…ô OTP g√∂nd…ôr</button>
      <input id="registerOtp" placeholder="OTP kodunu daxil edin">
      <button onclick="verifyOtp()">OTP-ni t…ôsdiql…ô</button>
      <div id="registerStatus"></div>
    </div>
    <div class="section">
      <h2>ƒ∞stifad…ô√ßi il…ô …ôlaq…ô</h2>
      <input id="searchPhone" placeholder="∆èlaq…ô saxlamaq ist…ôdiyiniz n√∂mr…ô">
      <button onclick="findUser()">Axtar</button>
      <div id="userStatus"></div>
    </div>
  </div>
  <script>
    async function sendOtp() {
      const phone = document.getElementById('registerPhone').value;
      if (!phone) return;
      try {
        await axios.post('http://localhost:3001/api/send-otp', { phone });
        document.getElementById('registerStatus').innerHTML = '<span class="success">OTP g√∂nd…ôrildi!</span>';
      } catch (e) {
        document.getElementById('registerStatus').innerHTML = '<span class="error">X…ôta ba≈ü verdi: '+(e.response?.data?.error || e.message)+'</span>';
      }
    }

    async function verifyOtp() {
      const phone = document.getElementById('registerPhone').value;
      const otp = document.getElementById('registerOtp').value;
      if (!otp || !phone) return;
      try {
        const res = await axios.post('http://localhost:3001/api/verify-otp', { phone, otp });
        if (res.data.success) {
          document.getElementById('registerStatus').innerHTML = '<span class="success">Qeydiyyat tamamlandƒ±!</span>';
        } else {
          document.getElementById('registerStatus').innerHTML = '<span class="error">OTP s…ôhvdir!</span>';
        }
      } catch (e) {
        document.getElementById('registerStatus').innerHTML = '<span class="error">X…ôta ba≈ü verdi: '+(e.response?.data?.error || e.message)+'</span>';
      }
    }

    async function findUser() {
      const phone = document.getElementById('searchPhone').value;
      if (!phone) return;
      try {
        const res = await axios.get('http://localhost:3001/api/user/' + phone);
        const user = res.data.user;
        document.getElementById('userStatus').innerHTML =
          `<span class="success">ƒ∞stifad…ô√ßi tapƒ±ldƒ±: ${user.phone} <br>Status: ${user.online ? "Online" : "Offline"}</span>`;
      } catch (e) {
        document.getElementById('userStatus').innerHTML = '<span class="error">ƒ∞stifad…ô√ßi tapƒ±lmadƒ±!</span>';
      }
    }
  </script>
</body>
</html>            border-radius: 5px;
        }
        .register-btn, .chat-btn {
            width: 100%;
            padding: 12px;
            background: #1976d2;
            color: #fff;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            margin-top: 15px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .register-btn:hover, .chat-btn:hover {
            background: #135ba1;
        }
        .login-link {
            margin-top: 17px;
            text-align: center;
            display: block;
            color: #1976d2;
            text-decoration: none;
        }
        .error {
            color: #d32f2f;
            text-align: center;
            margin-bottom: 10px;
        }
        .success {
            color: #388e3c;
            text-align: center;
            margin-bottom: 10px;
        }
        /* √áat stili */
        .chat-container {
            display: none;
            flex-direction: column;
            height: 420px;
            border-radius: 8px;
        }
        .chat-header {
            background: #1976d2;
            color: #fff;
            padding: 12px;
            border-radius: 8px 8px 0 0;
            font-size: 18px;
            text-align: center;
        }
        .chat-messages {
            flex: 1;
            padding: 15px;
            background: #f5f5f5;
            overflow-y: auto;
            min-height: 240px;
            max-height: 240px;
            border-bottom: 1px solid #ddd;
        }
        .chat-input-group {
            display: flex;
            padding: 8px 0 0 0;
        }
        .chat-input {
            flex: 1;
            padding: 10px;
            border: 1px solid #b6b6b6;
            border-radius: 5px 0 0 5px;
        }
        .chat-btn {
            border-radius: 0 5px 5px 0;
            width: 90px;
        }
        .msg-me {
            background: #c7e2ff;
            padding: 8px 13px;
            border-radius: 8px 8px 2px 8px;
            margin-bottom: 8px;
            max-width: 70%;
            align-self: flex-end;
            margin-left: 30%;
            font-size: 15px;
        }
        .msg-them {
            background: #f0f1f5;
            padding: 8px 13px;
            border-radius: 8px 8px 8px 2px;
            margin-bottom: 8px;
            max-width: 70%;
            align-self: flex-start;
            font-size: 15px;
        }
        .select-user {
            margin-bottom: 12px;
            width: 100%;
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }
        @media (max-width: 500px) {
            .container { width: 98%; padding: 10px; }
            .chat-header { font-size: 16px; }
        }
    </style>
    <script>
        // Demo √º√ß√ºn sad…ô istifad…ô√ßi siyahƒ±sƒ±
        const users = [
            {name: "Nicat", email: "nicat@gmail.com"},
            {name: "Aysel", email: "aysel@gmail.com"},
            {name: "Rasim", email: "rasim@gmail.com"}
        ];

        let currentUser = null;
        let selectedUser = null;

        function showChatUI() {
            document.getElementById('register-form').style.display = "none";
            document.querySelector('.chat-container').style.display = "flex";
            document.getElementById('chat-header-user').textContent = currentUser.name;
            // Dig…ôr istifad…ô√ßil…ôri se√ßm…ôk √º√ß√ºn siyahƒ± hazƒ±rla
            const select = document.getElementById('user-select');
            select.innerHTML = "";
            users.filter(u => u.email !== currentUser.email).forEach(user => {
                const opt = document.createElement("option");
                opt.value = user.email;
                opt.textContent = `${user.name} (${user.email})`;
                select.appendChild(opt);
            });
            if(select.options.length) {
                selectedUser = users.find(u => u.email === select.options[0].value);
            }
        }

        function validateForm(event) {
            event.preventDefault();
            var gmailInput = document.getElementById('gmail').value.trim();
            var passwordInput = document.getElementById('password').value.trim();
            var errorDiv = document.getElementById('error');
            var successDiv = document.getElementById('success');
            errorDiv.innerHTML = "";
            successDiv.innerHTML = "";
            var gmailPattern = /^[a-zA-Z0-9_.+-]+@gmail\.com$/;
            if (!gmailPattern.test(gmailInput)) {
                errorDiv.innerHTML = "Z…ôhm…ôt olmasa d√ºzg√ºn Gmail √ºnvanƒ± daxil edin!";
                return false;
            }
            if (passwordInput.length < 6) {
                errorDiv.innerHTML = "≈ûifr…ô …ôn azƒ± 6 simvoldan ibar…ôt olmalƒ±dƒ±r!";
                return false;
            }
            // Demo √º√ß√ºn qeydiyyat v…ô ya "daxil ol"
            let user = users.find(u => u.email === gmailInput);
            if (!user) {
                user = {name: gmailInput.split('@')[0], email: gmailInput};
                users.push(user);
            }
            currentUser = user;
            successDiv.innerHTML = "Qeydiyyat uƒüurla tamamlandƒ±, sisteme daxil olursunuz...";
            setTimeout(showChatUI, 900);
            return false;
        }

        function onUserChange(e) {
            selectedUser = users.find(u => u.email === e.target.value);
            document.getElementById('chat-messages').innerHTML = "";
        }

        function sendMessage(event) {
            event.preventDefault();
            const input = document.getElementById('chat-input');
            const msg = input.value.trim();
            if (!msg) return;
            const messagesDiv = document.getElementById('chat-messages');
            const myMsgDiv = document.createElement("div");
            myMsgDiv.className = "msg-me";
            myMsgDiv.textContent = msg;
            messagesDiv.appendChild(myMsgDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
            input.value = "";
            // Demo √º√ß√ºn cavab (real backend √º√ß√ºn burada mesaj g√∂nd…ôrm…ôk v…ô q…ôbul etm…ôk lazƒ±mdƒ±r)
            setTimeout(function() {
                const replyDiv = document.createElement("div");
                replyDiv.className = "msg-them";
                replyDiv.textContent = selectedUser ? selectedUser.name + ": Salam! üëã" : "Salam! üëã";
                messagesDiv.appendChild(replyDiv);
                messagesDiv.scrollTop = messagesDiv.scrollHeight;
            }, 800);
        }
    </script>
</head>
<body>
    <div class="container">
        <!-- Qeydiyyat formu -->
        <form id="register-form" onsubmit="validateForm(event)">
            <h2>Messenger Qeydiyyat</h2>
            <div class="input-group">
                <label for="gmail">Gmail √ºnvanƒ±:</label>
                <input type="email" id="gmail" name="gmail" placeholder="n√ºmun…ô@gmail.com" required>
            </div>
            <div class="input-group">
                <label for="password">≈ûifr…ô:</label>
                <input type="password" id="password" name="password" placeholder="≈ûifr…ônizi daxil edin" required>
            </div>
            <div id="error" class="error"></div>
            <div id="success" class="success"></div>
            <button type="submit" class="register-btn">Qeydiyyatdan ke√ß / Daxil ol</button>
        </form>

        <!-- √áat interfeysi -->
        <div class="chat-container" style="display:none; flex-direction: column;">
            <div class="chat-header">
                <span id="chat-header-user"></span> kimi daxil olmusunuz
            </div>
            <select class="select-user" id="user-select" onchange="onUserChange(event)">
            </select>
            <div id="chat-messages" class="chat-messages"></div>
            <form class="chat-input-group" onsubmit="sendMessage(event)">
                <input type="text" class="chat-input" id="chat-input" placeholder="Mesaj yazƒ±n...">
                <button class="chat-btn" type="submit">G√∂nd…ôr</button>
            </form>
        </div>
        <a href="#" class="login-link" onclick="location.reload()">√áƒ±xƒ±≈ü</a>
    </div>
</body>
</html>
  <script>
    // Firebase konfiqurasiya
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT_ID.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    // Firebase ba≈üladƒ±lƒ±r
    const app = firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const provider = new firebase.auth.GoogleAuthProvider();

    const loginPanel = document.getElementById("loginPanel");
    const chatPanel = document.getElementById("chatPanel");
    const googleLoginBtn = document.getElementById("googleLogin");
    const logoutBtn = document.getElementById("logoutBtn");
    const messagesDiv = document.getElementById("messages");
    const messageInput = document.getElementById("messageInput");
    const sendBtn = document.getElementById("sendBtn");

    let currentUser = null;

    // Gmail login redirect metodu
    googleLoginBtn.addEventListener("click", () => {
      auth.signInWithRedirect(provider);
    });

    // Google-dan qayƒ±dandan sonra istifad…ô√ßi m…ôlumatƒ±
    auth.getRedirectResult().then((result) => {
      if (result.user) {
        currentUser = result.user;
        showChatPanel();
      }
    }).catch(error => {
      console.error("Login x…ôtasƒ±:", error.message);
    });

    // Auth v…ôziyy…ôtini izl…ôyirik
    auth.onAuthStateChanged(user => {
      if (user) {
        currentUser = user;
        showChatPanel();
      } else {
        showLoginPanel();
      }
    });

    function showChatPanel() {
      loginPanel.classList.add("hidden");
      chatPanel.classList.remove("hidden");
      loadMessages();
    }

    function showLoginPanel() {
      chatPanel.classList.add("hidden");
      loginPanel.classList.remove("hidden");
    }

    // √áƒ±xƒ±≈ü
    logoutBtn.addEventListener("click", async () => {
      await auth.signOut();
    });

    // Mesajlarƒ± oxumaq
    function loadMessages() {
      db.collection("messages")
        .orderBy("timestamp")
        .onSnapshot(snapshot => {
          messagesDiv.innerHTML = "";
          snapshot.forEach(doc => {
            const msg = doc.data();
            const div = document.createElement("div");
            div.classList.add(
              "p-2", "my-1", "rounded-xl",
              msg.email === currentUser.email ? "bg-blue-200 text-right" : "bg-gray-200"
            );
            div.innerText = `${msg.name}: ${msg.text}`;
            messagesDiv.appendChild(div);
          });
          messagesDiv.scrollTop = messagesDiv.scrollHeight;
        });
    }

    // Mesaj g√∂nd…ôrm…ôk
    sendBtn.addEventListener("click", async () => {
      if (messageInput.value.trim() !== "" && currentUser) {
        await db.collection("messages").add({
          name: currentUser.displayName,
          email: currentUser.email,
          text: messageInput.value,
          timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });
        messageInput.value = "";
      }
    });
  </script>
</body>
</html>
  <script>
    // Firebase konfiqurasiya
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT_ID.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    // Firebase ba≈üladƒ±lƒ±r
    const app = firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const provider = new firebase.auth.GoogleAuthProvider();

    const loginPanel = document.getElementById("loginPanel");
    const chatPanel = document.getElementById("chatPanel");
    const googleLoginBtn = document.getElementById("googleLogin");
    const logoutBtn = document.getElementById("logoutBtn");
    const messagesDiv = document.getElementById("messages");
    const messageInput = document.getElementById("messageInput");
    const sendBtn = document.getElementById("sendBtn");

    let currentUser = null;

    // ƒ∞stifad…ô√ßi statusunu izl…ôyirik
    auth.onAuthStateChanged(user => {
      if (user) {
        currentUser = user;
        loginPanel.classList.add("hidden");
        chatPanel.classList.remove("hidden");
        loadMessages();
      } else {
        currentUser = null;
        chatPanel.classList.add("hidden");
        loginPanel.classList.remove("hidden");
      }
    });

    // Gmail il…ô login
    googleLoginBtn.addEventListener("click", async () => {
      try {
        await auth.signInWithPopup(provider);
      } catch (error) {
        alert("X…ôta ba≈ü verdi: " + error.message);
      }
    });

    // √áƒ±xƒ±≈ü
    logoutBtn.addEventListener("click", async () => {
      await auth.signOut();
    });

    // Mesajlarƒ± y√ºkl…ôm…ôk
    function loadMessages() {
      db.collection("messages")
        .orderBy("timestamp")
        .onSnapshot(snapshot => {
          messagesDiv.innerHTML = "";
          snapshot.forEach(doc => {
            const msg = doc.data();
            const div = document.createElement("div");
            div.classList.add(
              "p-2", "my-1", "rounded-xl",
              msg.email === currentUser.email ? "bg-blue-200 text-right" : "bg-gray-200"
            );
            div.innerText = `${msg.name}: ${msg.text}`;
            messagesDiv.appendChild(div);
          });
          messagesDiv.scrollTop = messagesDiv.scrollHeight;
        });
    }

    // Mesaj g√∂nd…ôrm…ôk
    sendBtn.addEventListener("click", async () => {
      if (messageInput.value.trim() !== "" && currentUser) {
        await db.collection("messages").add({
          name: currentUser.displayName,
          email: currentUser.email,
          text: messageInput.value,
          timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });
        messageInput.value = "";
      }
    });
  </script>
</body>
  </html>
