<!DOCTYPE html>
<html lang="az">
<head>
  <meta charset="UTF-8">
  <title>IPTV Player</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: black;
      color: white;
      font-family: Arial, sans-serif;
      overflow: hidden;
    }

    #player-container {
      position: relative;
      width: 100%;
      height: 100%;
    }

    video {
      width: 100%;
      height: 100%;
      object-fit: contain;
      aspect-ratio: 16 / 9;
      background: black;
    }

    #clock, #channelName {
      position: absolute;
      background: rgba(0,0,0,0.6);
      padding: 6px 12px;
      border-radius: 5px;
      font-size: 16px;
      z-index: 10;
      pointer-events: none;
    }

    #clock {
      top: 10px;
      left: 10px;
    }

    #channelName {
      top: 10px;
      right: 10px;
    }

    #channelList {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.95);
      overflow-y: auto;
      display: none;
      z-index: 20;
    }

    .list-item {
      padding: 15px;
      font-size: 20px;
      border-bottom: 1px solid #333;
      cursor: pointer;
      user-select: none;
    }

    .list-item.active, .list-item:hover {
      background: #555;
    }
  </style>
</head>
<body>

<div id="player-container">
  <video id="videoPlayer" autoplay controls playsinline></video>
  <div id="clock"></div>
  <div id="channelName">Yüklənir...</div>
  <div id="channelList"></div>
</div>

<script>
  const video = document.getElementById("videoPlayer");
  const channelNameDisplay = document.getElementById("channelName");
  const clock = document.getElementById("clock");
  const channelListDiv = document.getElementById("channelList");

  let channelData = [];
  let currentIndex = 0;
  let selectedListIndex = 0;
  let listVisible = false;

  function updateClock() {
    const now = new Date();
    const date = now.toLocaleDateString('az-AZ');
    const time = now.toLocaleTimeString('az-AZ');
    clock.innerText = `${date} ${time}`;
  }
  setInterval(updateClock, 1000);
  updateClock();

  const m3u8Url = 'https://raw.githubusercontent.com/nicatiptv/a/refs/heads/main/playlist.m3u';

  fetch(m3u8Url)
    .then(res => res.text())
    .then(data => {
      const lines = data.split('\n');
      let channel = {};
      lines.forEach((line, i) => {
        if (line.startsWith('#EXTINF')) {
          const nameMatch = line.match(/,(.*)/);
          if (nameMatch) {
            channel.name = nameMatch[1].trim();
          } else {
            channel.name = 'Naməlum Kanal';
          }
        } else if (line.startsWith('http')) {
          channel.url = line.trim();
          if (!channel.name) {
            const urlParts = channel.url.split('/');
            const fileName = decodeURIComponent(urlParts[urlParts.length - 1].split('.')[0]);
            channel.name = fileName.replace(/[_\-]/g, ' ');
          }
          channelData.push({ ...channel });
          channel = {};
        }
      });

      showChannelList();
      if (channelData.length > 0) playChannel(channelData[0]);
      else channelNameDisplay.innerText = 'Kanal siyahısı boşdur';
    });

  function playChannel(channel) {
    if (!channel) return;
    video.src = channel.url;
    video.play().catch(console.warn);
    channelNameDisplay.innerText = channel.name;
    currentIndex = channelData.indexOf(channel);
    highlightSelected(currentIndex);
  }

  function showChannelList() {
    channelListDiv.innerHTML = '';
    channelData.forEach((ch, i) => {
      const item = document.createElement('div');
      item.className = 'list-item';
      item.innerText = ch.name;
      item.dataset.index = i;
      item.addEventListener('click', () => {
        playChannel(ch);
        toggleChannelList(false);
      });
      channelListDiv.appendChild(item);
    });
  }

  function toggleChannelList(show) {
    listVisible = show;
    channelListDiv.style.display = show ? 'block' : 'none';
    if (show) {
      selectedListIndex = currentIndex;
      highlightSelected(selectedListIndex);
    }
  }

  function highlightSelected(index) {
    const items = document.querySelectorAll('.list-item');
    items.forEach(item => item.classList.remove('active'));
    if (items[index]) {
      items[index].classList.add('active');
      items[index].scrollIntoView({ block: 'center' });
    }
  }

  document.addEventListener("keydown", e => {
    if (listVisible) {
      if (e.key === 'ArrowUp') {
        if (selectedListIndex > 0) selectedListIndex--;
        highlightSelected(selectedListIndex);
      } else if (e.key === 'ArrowDown') {
        if (selectedListIndex < channelData.length - 1) selectedListIndex++;
        highlightSelected(selectedListIndex);
      } else if (e.key === 'Enter') {
        playChannel(channelData[selectedListIndex]);
        toggleChannelList(false);
      } else if (e.key === 'Backspace' || e.key === 'Escape') {
        toggleChannelList(false);
      }
    } else {
      if (e.key === 'ArrowUp') {
        if (currentIndex < channelData.length - 1) {
          currentIndex++;
          playChannel(channelData[currentIndex]);
        }
      } else if (e.key === 'ArrowDown') {
        if (currentIndex > 0) {
          currentIndex--;
          playChannel(channelData[currentIndex]);
        }
      } else if (e.key === 'Enter') {
        toggleChannelList(true);
      }
    }
  });

  // Sensor (touch) ilə kanal dəyişimi
  let startY = null;
  document.getElementById("player-container").addEventListener("touchstart", e => {
    if (e.touches.length === 1) startY = e.touches[0].clientY;
  });

  document.getElementById("player-container").addEventListener("touchend", e => {
    if (startY === null) return;
    const endY = e.changedTouches[0].clientY;
    const deltaY = endY - startY;
    startY = null;

    if (Math.abs(deltaY) > 50) {
      if (deltaY < 0 && currentIndex < channelData.length - 1) {
        currentIndex++;
        playChannel(channelData[currentIndex]);
      } else if (deltaY > 0 && currentIndex > 0) {
        currentIndex--;
        playChannel(channelData[currentIndex]);
      }
    }
  });
</script>

</body>

</html>
